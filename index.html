<!DOCTYPE html>
<html>
	<head>
		<style>

			body { background: #888; }

			.container { 
				margin: auto; margin-top: 40px; width: 600px; height: 400px; box-shadow: 0px 0px 10px #333;
				background: #eee;
				font: 14px arial, verdana, sans-serif;
				position: relative;
			}

			h1 { font-size: 40px; padding: 30px; color: #66d; margin: 0px; }
			p { background: #44b; padding: 30px; margin: 0px; color: #fff; }
			
			ul { margin: 0px; padding: 0px; background: #222; }
			ul ul { margin-left: 20px; }
			ul li { 
				list-style: none; color: #fff; padding: 10px; padding-left: 30px; 
				background: #161819;
			}

			*[draggable] { cursor: move; }
		</style>
		<script src="js/jquery-1.9.0.min.js"></script>
		<script src="js/jquery.html5dragdrop.js"></script>
		<script>

			$(function() {

				// List
				var list = $(".container .list").html5dragdrop({
					draggables : "li",
					droppables : "ul, li",
					onDragStart : function(draggedElement, details) {
						draggedElement.animate({
							opacity: 0.2
						});
					},
					onDragCancelled : function(draggedElement, details) {
						draggedElement.animate({
							opacity: 1
						});
					},
					onDrop : function(draggedElement, destinationDroppable, details) {
						draggedElement.animate({
							opacity: 1
						});
						placeAtList(draggedElement, details.currentlyHoveredElement, details);
					},
					onHoverDroppable : function(draggedElement,  hoveredDroppable, details) {
						placeAtList(draggedElement, details.currentlyHoveredElement, details);
					}
				});
				function placeAtList(elementToPlace, target, details) {
					if (details.mouseLocation.inCurrentElement.y < target.height() / 2) {
						// Place before element
						target.before(elementToPlace);
					} else if (details.mouseLocation.inCurrentElement.y > target.height() * 3/4) {
						// Place after element
						target.after(elementToPlace);
					}
					list.update();
				}


				// Tree
				var treeView = $(".container tree").html5dragdrop({
					draggables : "li",
					droppables : "ul, li",
					onDragStart : function(draggedElement, details) {
						draggedElement.animate({
							opacity: 0.2
						});
					},
					onDragCancelled : function(draggedElement, details) {
						$(".container").find(".potentialDestination").remove();
						draggedElement.animate({
							opacity: 1
						});
					},
					onDrop : function(draggedElement, destinationDroppable, details) {
						draggedElement.animate({
							opacity: 1
						});
						placeAtTarget(draggedElement, details.currentlyHoveredElement, details);
						$(".container").find(".potentialDestination").remove();
					},
					onHoverDroppable : function(draggedElement, hoveredDroppable, details) {
						// Don't do anything if we are currently hovering the .potentialDestination
						if (hoveredDroppable.is(treeView.getRoot().find(".potentialDestination"))) {
							return;
						}
						$(".container").find(".potentialDestination").remove();
						placeAtTarget($("<li class='potentialDestination'>&nbsp</li>"), details.currentlyHoveredElement, details);
					}
				});
				function placeAtTarget(elementToPlace, target, details) {
					if (details.mouseLocation.inCurrentElement.y < target.height() * 1/4) {
						// Place before element
						target.before(elementToPlace);
					} else if (details.mouseLocation.inCurrentElement.y > target.height() * 3/4) {
						// Place after element
						target.after(elementToPlace);
					} else {
						// Place 'under'/in element
						var c = $("<ul>");
						target.append(c);
						c.append(elementToPlace);
					}
					treeView.update();
				}

			});
		</script>
	</head>
	<body>
		<div class='container'>
			<h1>HTML5 Drag&Drop</h1>
			<p>The simplest example would be a list</p>
			<ul class='list'>
				<li>item 1</li>
				<li>item 2</li>
				<li>item 3</li>
				<li>item 4</li>
			</ul>
			<p>But a tree is also easy</p>
			<ul class='tree'>
				<li class='file1'>hai</li>
				<li class='folder'>folder
					<ul>
						<li class='file2'>file</li>
					</ul>
				</li>
			</ul>
			<button onclick='$(".tree1").append("<li>added</li>"); $(".container").html5dragdrop().update();'>Add tree element</button>
		</div>
		<script>
			// Analytics
		</script>
	</body>
</html>